# 剪贴板同步工具 - TCP直连版本

这是一个不依赖 Iroh 或 UDP 多播的剪贴板同步工具实现，使用 TCP 直接连接进行设备间的数据传输。

## 实现原理

### 网络架构
- **直接连接**: 使用 TCP 连接进行可靠的剪贴板数据传输
- **点对点**: 设备之间通过指定的 IP 地址和端口直接连接
- **实时同步**: 500ms 间隔监控剪贴板变化

### 核心功能
1. **直接连接**: 通过指定 IP 地址和端口连接到其他设备
2. **双向同步**: 支持文本和图片剪贴板内容的双向同步
3. **多设备支持**: 可同时连接多个设备进行同步
4. **实时同步**: 实时检测并同步剪贴板变化

## 编译运行

### 编译
```bash
# 编译项目
cargo build
```

### 运行

#### 作为服务器启动（监听连接）
```bash
cargo run -- start --name "我的电脑" --port 8765
```

#### 连接到其他设备
```bash
cargo run -- connect --name "我的电脑" 192.168.1.100 --port 8765
```

## 使用说明

### 启动同步服务（作为服务器）
```bash
cargo run -- start --name "我的电脑" --port 8765
```

### 连接到指定设备
```bash
cargo run -- connect --name "我的电脑" 192.168.1.100 --port 8765
```

## 网络端口说明

- **默认端口**: 8765 (TCP) - 用于剪贴板数据传输
- **可自定义**: 可以通过 `--port` 参数指定其他端口

## 工作流程

1. **服务启动**: 
   - 绑定 TCP 端口并监听连接
   - 等待其他设备连接

2. **建立连接**:
   - 其他设备使用 `connect` 命令连接到服务器
   - 建立 TCP 连接用于数据传输

3. **剪贴板同步**:
   - 500ms 间隔检查剪贴板变化
   - 检测到变化后立即广播给所有连接的设备
   - 接收到其他设备的剪贴板数据后更新本地剪贴板

4. **错误处理**:
   - 自动重连断开的设备
   - 清理失效的连接
   - 优雅处理网络错误

## 与原版本的区别

| 特性 | 原版本 (Iroh) | 当前版本 (TCP直连) |
|------|---------------|-------------------|
| 依赖 | iroh, n0-future, futures-lite | 标准 tokio |
| 发现机制 | Iroh 内置发现 | 手动指定 IP 和端口 |
| 数据传输 | Iroh 协议 | 标准 TCP |
| 复杂度 | 较高 | 较低 |
| 可定制性 | 较低 | 较高 |
| 网络穿透 | 支持 | 仅局域网 |

## 优势
- **轻量级**: 不依赖复杂的 P2P 库
- **标准协议**: 使用标准的 TCP 协议
- **易于理解**: 网络逻辑简单清晰
- **易于调试**: 可以使用标准网络工具进行调试
- **高兼容性**: 兼容所有支持标准网络协议的系统

## 局限性
- **仅支持局域网**: 不支持跨网络同步
- **无加密**: 数据传输未加密
- **无认证**: 没有设备认证机制
- **手动连接**: 需要手动指定 IP 地址

## 故障排除

### 连接问题
1. 检查 TCP 端口是否被占用
2. 确认防火墙允许相应的 TCP 端口
3. 验证网络连通性

### 剪贴板同步问题
1. 确认剪贴板权限
2. 检查系统剪贴板服务状态
3. 验证图片格式支持

## 扩展建议

1. **加密支持**: 添加 TLS 加密
2. **认证机制**: 添加设备认证
3. **配置文件**: 支持配置文件自定义设置
4. **日志系统**: 添加详细的日志记录
5. **GUI界面**: 开发图形用户界面